<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Login | Acompanhamento de Atividades - DP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/locales-all.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" href="logo.png">
</head>
<body>

<!-- Splash -->
<div id="splash" style="display: none;">
    <img src="logo.png" class="logo" alt="Nordil Logo">
</div>

<!-- Login -->
<div id="login">
    <h2>Login</h2>
    <form id="loginForm" autocomplete="off">
        <input type="text" id="usuario" placeholder="Usu√°rio" required autofocus>
        <input type="password" id="senha" placeholder="Senha" required>
        <button type="submit">Entrar</button>
    </form>
    <p id="erroLogin"></p>
</div>

<!-- Header -->
<header style="display:none;">
    <div class="header-content">
        <img src="logo.png" class="logo" alt="Nordil Logo">
        <h1>Acompanhamento de Atividades - Departamento Pessoal</h1>
        <span id="usuarioLogado" class="usuario-logado"></span>
        <button id="btnAjuda" title="Instru√ß√µes" class="btn-header">
            <svg width="20" height="20" fill="none" stroke="#0a49a7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;">
                <circle cx="10" cy="10" r="8.5"/>
                <text x="10" y="15" text-anchor="middle" font-size="14" fill="#0a49a7" font-family="Arial, sans-serif">?</text>
            </svg>
        </button>
        <button id="btnTema" title="Alternar tema" class="btn-header">üåô</button>
        <button id="btnLogout" title="Sair" class="btn-header" onclick="fazerLogout()">Sair</button>
    </div>
</header>

<div class="nav-tabs" style="display:none;">
    <button id="btnCalendario" class="active" onclick="abrirAba('calendario')">üìÖ <span>Calend√°rio</span></button>
    <button id="btnDashboard" onclick="abrirAba('dashboard')">üìä <span>Dashboard</span></button>
    <button id="btnUsuarios" onclick="abrirAba('usuarios')" style="display:none;">üë• <span>Usu√°rios</span></button>
</div>

<!-- Calend√°rio -->
<section id="aba-calendario" style="display:none;">
    <div class="top-actions">
        <div class="card card-upload">
            <div class="card-header">
                <span class="icon-upload">
                    <svg width="26" height="26" ...></svg>
                </span>
                <span><b>Upload CSV</b></span>
            </div>
            <div class="input-upload-group">
                <input type="file" id="csvFile" class="input-upload">
                <button class="btn-upload" onclick="processCSV()">Carregar Dados</button>
            </div>
            <div class="btns-row">
                <button id="btnLimparCalendario" class="btn-limpar">üßπ Limpar Calend√°rio</button>
                <button id="btnAdicionarAtividade" class="btn-adicionar">+ Adicionar Atividade</button>
            </div>
        </div>
        <div class="card card-filtro">
            <div class="card-header">
                <span class="icon-filter">
                    <svg width="24" height="24" ...></svg>
                </span>
                <span><b>Filtrar Atividades</b></span>
            </div>
            <label for="responsavelSelect">Respons√°vel:</label>
            <select id="responsavelSelect" onchange="filtrarPorResponsavel()">
                <option value="todos">Todos</option>
            </select>
        </div>
    </div>
    <div id="calendar"></div>
</section>

<!-- Modal Adicionar Atividade -->
<div id="modalAdicionarAtividade" class="modal">
    <div class="modal-content">
        <span class="close" onclick="fecharModalAdicionarAtividade()">&times;</span>
        <h3>Adicionar Nova Atividade</h3>
        <form id="formAdicionarAtividade" autocomplete="off">
            <label>Data:<br>
                <input type="date" id="novaData" required>
            </label><br>
            <label>Respons√°vel:<br>
                <input type="text" id="novoResponsavel" required>
            </label><br>
            <label>Atividade:<br>
                <input type="text" id="novaAtividade" required>
            </label><br>
            <button type="submit" class="btn-adicionar" style="margin-top:14px;width:100%;">Salvar</button>
        </form>
        <p id="msgAdicionarAtividade" style="color:#2ecc71; margin-top:6px;"></p>
    </div>
</div>


<!-- Dashboard -->
<section id="aba-dashboard" style="display:none;">
    <div class="dashboard">
        <div class="cardsResumo">
            <div class="cardResumo"><h3>Total</h3><p id="totalAtividades">0</p></div>
            <div class="cardResumo"><h3>Realizadas</h3><p id="totalRealizadas">0</p></div>
            <div class="cardResumo"><h3>N√£o Realizadas</h3><p id="totalNaoRealizadas">0</p></div>
            <div class="cardResumo"><h3>% Conclu√≠do</h3><p id="percentualConclusao">0%</p></div>
        </div>
        <canvas id="graficoBarras"></canvas>
        <canvas id="graficoLinha"></canvas>
        <h3 style="margin-top:32px; margin-bottom:12px;">Motivos de N√£o Realiza√ß√£o</h3>
        <canvas id="graficoMotivos"></canvas>
        <button onclick="exportarResumo()">üì§ Exportar CSV</button>
        <h3>Lista Detalhada de Atividades</h3>
        <table id="tabelaAtividades">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Respons√°vel</th>
                    <th>Atividade</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</section>

<!-- Usu√°rios -->
<section id="aba-usuarios" style="display:none;">
    <h2>Gerenciar Usu√°rios</h2>
    <form id="usuarioForm" autocomplete="off">
        <input type="text" id="novoUsuario" placeholder="Usu√°rio" required>
        <input type="password" id="novaSenha" placeholder="Senha" required>
        <select id="novoTipo">
            <option value="comum">Comum</option>
            <option value="admin">Admin</option>
        </select>
        <button type="submit">Adicionar</button>
    </form>
    <h3>Lista de Usu√°rios</h3>
    <table id="tabelaUsuarios">
        <thead>
            <tr>
                <th>Usu√°rio</th>
                <th>Tipo</th>
                <th>A√ß√µes</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</section>

<!-- Modal Atividade -->
<div id="modalAtividade" class="modal">
    <div class="modal-content">
        <span class="close" onclick="fecharModal()">&times;</span>
        <h3 style="margin-bottom: 22px;">Detalhes da Atividade</h3>
        <div class="atividade-info">
            <div><strong>Data:</strong> <span id="modalData"></span></div>
            <div><strong>Respons√°vel:</strong> <span id="modalResponsavel"></span></div>
            <div><strong>Atividade:</strong> <span id="modalAtv"></span></div>
        </div>
        <div class="modal-buttons">
            <button class="btn-success" onclick="marcarStatusModal(true)">Marcar como Realizado</button>
            <button class="btn-warning" onclick="mostrarSelectMotivo()">N√£o Realizado</button>
        </div>
        <div id="selectMotivo" style="display:none;margin-top:18px;">
            <label><strong>Motivo do N√£o Realizado:</strong></label>
            <select id="motivoNaoRealizado">
                <option value="Falta de Tempo">Falta de Tempo</option>
                <option value="Informa√ß√£o Incompleta">Informa√ß√£o Incompleta</option>
                <option value="Imprevisto Operacional">Imprevisto Operacional</option>
            </select>
            <button class="btn-danger" style="margin-left: 12px;" onclick="marcarStatusModal(false)">Salvar N√£o Realizado</button>
        </div>
    </div>
</div>

<!-- Modal de Instru√ß√µes -->
<div id="modalAjuda" class="modal">
    <div class="modal-content">
        <span class="close" onclick="fecharModalAjuda()">&times;</span>
        <h3>Instru√ß√µes de Uso</h3>
        <ul>
            <li><b>Login:</b> Acesse com seu usu√°rio e senha.</li>
            <li><b>Calend√°rio:</b> Clique em um dia para ver/editar atividades.</li>
            <li><b>Upload CSV:</b> Importe atividades em massa pelo arquivo.</li>
            <li><b>Dashboard:</b> Veja gr√°ficos e status de execu√ß√£o.</li>
            <li><b>Usu√°rios:</b> (Apenas admin) Cadastre, edite ou remova acessos.</li>
            <li><b>Filtros:</b> Selecione um respons√°vel para filtrar as atividades.</li>
            <li><b>Tema:</b> Use üåô/‚òÄÔ∏è para alternar entre claro e escuro.</li>
            <li><b>Sair:</b> Clique em "Sair" ou pressione <b>ESC</b> para sair.</li>
        </ul>
        <p style="font-size: 0.9em; margin-top: 10px; color: #555;">D√∫vidas ou problemas? Fale com o suporte DP/Nordil.</p>
    </div>
</div>

<!-- Rodap√© -->
<footer style="display:none;">
    <div class="footer-content">
        <img src="logo.png" alt="Nordil" class="logo-footer">
        <span>&copy; <span id="anoAtual"></span> Nordil ‚Ä¢ Departamento Pessoal</span>
    </div>
</footer>

<!-- Firebase + Script -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBndhAbgEbFxCZvTVfkqMH6MTuyzhPTxUo",
  authDomain: "nordil-atividades.firebaseapp.com",
  projectId: "nordil-atividades",
  storageBucket: "nordil-atividades.appspot.com",
  messagingSenderId: "138660523776",
  appId: "1:138660523776:web:d47955e6b48401c233cde5"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>
<script src="script.js"></script>
<script>
  document.getElementById('anoAtual').textContent = new Date().getFullYear();
</script>
<script>
document.getElementById('btnAjuda').onclick = function() {
    document.getElementById('modalAjuda').style.display = 'block';
};
window.fecharModalAjuda = function() {
    document.getElementById('modalAjuda').style.display = 'none';
};
window.onclick = function(event) {
    if (event.target === document.getElementById('modalAjuda')) {
        fecharModalAjuda();
    }
};
document.addEventListener('keydown', function(e) {
    if (e.key === "Escape") {
        fecharModalAjuda();
    }
});
</script>
</body>
</html>
